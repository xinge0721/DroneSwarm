# DroneSwarm 智能无人机集群控制系统

基于ESP32-S3的无人机控制系统，集成GPS定位、姿态控制、语音指挥和AI协作功能，构建智能化、可扩展的无人机集群平台

## 项目架构

本项目采用**智能化四层架构设计**：
```
┌─────────────────┐    WiFi-UDP    ┌──────────────────┐    语音指挥    ┌─────────────────┐
│   无人机端      │ ◄─────────────► │    上位机ROS     │ ◄──────────► │   AI协作系统    │
│   (ESP32-S3)    │                │   (Ubuntu/ROS1)  │              │  (语音+星火AI)   │
└─────────────────┘                └──────────────────┘              └─────────────────┘
        │                                    │                                │
        ▼                                    ▼                                ▼
  姿态控制+GPS定位              路径规划+数据处理+监控              语音识别+智能决策+TTS
```

## 项目结构

```
DroneSwarm/
├── docs/                       # 📋 项目文档
│   └── 技术路线规划.md          # 详细的系统设计文档
├── Hardware/                   # 🔧 硬件设计文件
│   ├── CDA/                    # 3D机身模型
│   └── PCB/                    # 电路板设计
├── Software/                   # 💻 软件代码
│   ├── UAV_ESP/                # ✅ ESP32固件 (开发中)
│   │   ├── Hardware/           # 硬件驱动模块
│   │   ├── System/             # 系统功能模块
│   │   └── main/               # 主程序
│   └── Hive_control_ROS/       # 🚀 ROS智能上位机 (功能丰富)
│       └── src/                # ROS功能包
│           ├── swarm_*/        # 无人机核心功能包
│           ├── language/       # 🎤 语音识别模块
│           ├── xinhuo/         # 🤖 星火AI对话模块
│           ├── mic/            # 🔊 语音合成&麦克风阵列
│           └── 环境/            # ⚡ 一键配置脚本
│               ├── robot.sh    # 智能环境安装脚本
│               └── ch9102_udev.sh  # 串口设备权限
└── test/                       # 🧪 测试文件
```

## 开发状态

> 🚨 **注意**: 这是个人学习项目，大部分代码还在开发中，很多模块只是搭建了基础框架

### 🚧 当前开发中
- **ESP32固件框架** - 基于ESP-IDF，部分复用以前代码
  - 🏗️ 基础WiFi/UDP通信框架
  - 🏗️ 硬件驱动模块（13个模块框架已建立）
    - 传感器接口定义（GPS/JY60/MPU6050等）
    - 执行器控制接口（PWM/LED/蜂鸣器等）
  - 🏗️ 系统算法模块
    - PID控制器（基础实现）
    - 卡尔曼滤波（框架搭建）
  - ✅ 编译构建系统

### 🚀 **新增亮点功能** - 智能语音AI系统
- **语音指挥系统** - 复用现有语音识别框架
  - ✅ 基于Vosk的离线中文语音识别
  - ✅ 自适应语音活动检测(VAD)算法  
  - ✅ 麦克风阵列支持和ROS话题集成
- **AI智能决策** - 基于讯飞星火大模型
  - ✅ WebSocket实时AI对话连接
  - ✅ 智能对话历史管理
  - ✅ 自然语言指令解析
- **语音合成反馈** - TTS语音输出系统
  - ✅ 讯飞TTS引擎集成
  - ✅ 实时语音状态播报
  - ✅ 多语音角色支持

### 📋 ROS智能上位机部分
- **核心无人机功能包** - 基础框架，待完善实现
  - 📦 `udp_ros_bridge` - UDP↔ROS话题转换（有基础实现）
  - 📦 `swarm_data_processor` - 数据处理（框架搭建）
  - 📦 `swarm_planner` - 路径规划（框架搭建）
  - 📦 `swarm_monitor` - 监控可视化（框架搭建）

- **🎯 智能语音AI功能包** - 复用现有代码，功能完备
  - 📦 `language` - 语音识别包（✅ Vosk中文识别完整实现）
  - 📦 `xinhuo` - AI对话包（✅ 星火大模型API完整集成）
  - 📦 `mic` - 语音合成包（✅ TTS引擎和麦克风阵列支持）

### 🎯 下一步计划
- **硬件集成阶段**
  - 完善ESP32各硬件模块的具体实现
  - 集成测试WiFi通信和传感器数据读取
  - 硬件调试和PID参数调优

- **智能化升级阶段** 🌟
  - 将语音AI系统与无人机控制逻辑深度融合
  - 实现自然语言飞行指令解析（"飞到那边"→坐标转换）
  - 开发AI辅助的集群协作决策算法
  - 集成语音状态播报和异常告警系统

- **系统联调阶段**
  - 语音指挥→AI理解→路径规划→飞行控制全链路测试
  - 多机协同语音指挥场景验证
  - 安全机制和应急语音指令实现

## 设计目标

### 🎯 ESP32固件端（规划中）
- **多传感器融合**：JY60姿态+NEO-M8N GPS+电池监控
- **高频控制循环**：目标100Hz姿态控制，50Hz数据上传
- **实时参数调试**：UART0接口支持PID参数实时调整
- **资源优化设计**：硬件资源精确分配，避免冲突

### 🖥️ ROS智能上位机端（功能丰富）
- **模块化架构**：七个功能包各司其职，便于扩展
- **坐标系转换**：GPS经纬度→UTM坐标，便于路径计算
- **实时监控**：电池电压、GPS信号强度、飞行状态
- **可视化界面**：RViz显示飞行轨迹和系统状态

### 🎤 **智能语音AI端**（已实现核心功能）
- **语音识别系统**：离线Vosk引擎，支持中文识别和自适应VAD
- **AI智能对话**：星火大模型API，支持自然语言指令理解
- **语音合成系统**：讯飞TTS引擎，多角色语音播报
- **智能决策支持**：AI辅助路径规划和集群协作决策

## 快速开始

### 环境要求
- **无人机端**：ESP-IDF v5.0+
- **上位机端**：Ubuntu 20.04 + ROS Noetic
- **硬件**：ESP32-S3 + JY60 + NEO-M8N + OLED显示屏
- **语音AI端**：
  - Python 3.8+ (ROS Noetic兼容)
  - 麦克风阵列设备（支持USB Audio）
  - 讯飞开放平台账号（星火API调用）
  - ⚡ **一键配置脚本**：`robot.sh`自动安装所有依赖

### 编译ESP32固件
```bash
cd Software/UAV_ESP
idf.py build
idf.py flash monitor
```

### 编译ROS功能包
```bash
cd Software/Hive_control_ROS
catkin_make
source devel/setup.bash
```

### 🔧 一键环境配置（语音AI系统）
**重要：首次使用前必须运行环境配置脚本**
```bash
cd Software/Hive_control_ROS/环境
sudo chmod +x robot.sh
sudo ./robot.sh
```
**此脚本将自动完成：**
- ✅ 安装系统依赖包（音频库、Python包等）
- ✅ 下载Vosk中文语音模型（约200MB）
- ✅ 配置音频设备权限
- ✅ 安装讯飞TTS引擎依赖
- ✅ 测试语音识别功能
- ✅ 创建必要的目录结构

### 🎤 启动语音AI系统
```bash
# 启动语音识别节点
rosrun language voice_recognition.py

# 启动AI对话节点
rosrun xinhuo SparkPy.py

# 启动TTS语音合成（需要配置讯飞参数）
roslaunch mic tts_make.launch
```

## 硬件配置

| 模块 | 型号 | 接口 | 功能 |
|------|------|------|------|
| 主控 | ESP32-S3 | - | 双核处理器，240MHz |
| 姿态传感器 | JY60 | UART2 | 三轴姿态数据 |
| GPS模块 | NEO-M8N | UART1 | 室外定位 |
| 显示屏 | 0.96" OLED | I2C1 | 状态显示 |
| 电机驱动 | 8520空心杯×4 | PWM | 四轴推进 |
| **语音设备** | **麦克风阵列** | **USB** | **语音指挥输入** |
| **AI处理** | **讯飞星火API** | **WebSocket** | **智能对话决策** |

## 通信协议

### UDP数据格式（JSON）
```json
{
  "drone_id": "test_01",
  "roll": 1.1, "pitch": 0.8, "yaw": 359.2,
  "lat": 30.123456, "lon": 120.654321,
  "sat": 13, "batt": 3.85,
  "pid_p": 2.5, "pid_i": 0.3, "pid_d": 0.8
}
```

### 🎤 语音AI通信协议
```
语音指挥流程：
用户语音 → /mic/awake/angle (触发) → chatter (识别结果) → xinhuo (AI处理) → /tts/text (语音反馈)
                                        ↓
                                  /cmd/voice (飞行指令)
                                        ↓
                                swarm_planner (路径规划)
```

### ROS话题通信
```bash
# 核心话题
/chatter              # 语音识别结果 (std_msgs/String)
/tts/text            # TTS语音合成 (std_msgs/String)  
/mic/awake/angle     # 麦克风唤醒角度 (std_msgs/Int32)
/cmd/voice           # 语音飞行指令 (geometry_msgs/Twist)
/drone_status        # 无人机状态反馈 (自定义消息)
```

### 网络配置
- **ESP32 IP**：192.168.1.101（固定）
- **上位机端口**：8888（UDP）
- **数据频率**：50Hz上传，20Hz下载
- **星火AI API**：WebSocket连接（wss://spark-api.xf-yun.com/v4.0/chat）
- **语音识别**：离线处理，无需网络连接

## 开发笔记

这是个人学习和研究无人机控制系统的项目，目标是：
- 深入理解ESP32嵌入式开发
- 学习ROS机器人操作系统
- 掌握多传感器融合和控制算法
- 探索无人机集群协同控制

### 🚀 **项目亮点升级**
通过复用现有的语音AI代码框架，本项目实现了：
- **自然语言飞行控制**："飞到那边" → GPS坐标解析 → 自动飞行
- **AI辅助决策**：星火大模型理解复杂指令，辅助路径规划
- **智能状态播报**：实时语音播报飞行状态、电池电量、GPS信号等
- **多机协同指挥**："所有无人机返航" → 集群统一控制
- **安全应急处理**：语音识别紧急指令，如"立即悬停"、"紧急降落"

## 项目状态

- **当前版本**: v0.2.0-beta（智能语音AI版本）
- **开发阶段**: 智能化功能集成
- **更新日期**: 2025-10-11
- **核心特色**: 语音指挥 + AI协作 + 传统无人机控制完美融合

如果你对无人机控制、ESP32开发或ROS系统感兴趣，欢迎参考本项目的代码和文档。